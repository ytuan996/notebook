### Java类加载机制

#### 1. 类加载的时机

类的生命周期：加载、连接(验证、准备、解析)、初始化、使用、卸载.其中加载、验证、准备、初始化都是确定的,只有解析是动态的，
主要是为了完成java的动态绑定。

什么情况下必须完成类的初始化：

    1. 遇到new关键字，或者调用一个类的静态字段或者静态方法时。(调用被final修饰的常量不会触发类的初始化)
    2. 反射调用的时候
    3. 初始化的父类
    4. main方法所在的类
    5. 动态语言支持的时候

接口中不能有static语句块，接口与类的加载时机不同的是，如果在接口中没有使其父类，那么它的父类不会像类一样会被加载。

#### 2. 类加载的过程

- 加载

    1. 根据类的全限定名获取到类的二进制流
    2. 将字节流的静态存储结构转为方法区的运行时数据结构
    3. 在内存中生成代表该类的Class对象，作为方法区访问该类的入口
    
对于数组的加载来说，不是直接使用类加载器，而是右虚拟机直接创建，但是数组的元素类型是引用类型，那么也会执行类的加载过程，

- 验证

确保Class中的信息不会对虚拟机造成威胁。

- 准备

为类变量(静态变量)分配内存并设置变量的初始值，在方法区分配。需要注意的是这里指的是static修饰的变量，否则是在类的实例化
时在Java堆中分配的。

- 解析

将常量池内的符号引用替换为直接引用的过程; 符号引用是能够无歧义的描述所引用的目标，与JVM无关；而直接引用则是直接指向
引用的目标对象，不同的JVM可能实现各不相同。

- 初始化

类初始化是类加载过程的最后一步，在此之前，除了类加载时可指定类加载器之外，其余阶段都是由JVM主导，控制的。到了初始化阶段，
才真正的按照程序代码执行。