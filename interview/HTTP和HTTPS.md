### HTTP和HTTPS

#### 1. HTTP 的缺点

- 通信使用明文可能会被监听

    1. HTTP本身不具备加密的功能；无法对通信报文进行加密，只能明文传输。TCP/IP是可能被监听的网络：按照TCP/IP
    协议族的工作机制，通信内容在所有的通信链路上都有可能被监听，为了安全，最普遍的就是对数据进行加密了再传输，
    当然加密的数据也可以被监听，只是别人不一定能破密而已。
    
    通常加密的方法有几种：
    
        1. 通信的加密：虽然HTTP没有加密机制，但可以通过和SSL(Secure Socket Layer)或者TSL(Transport Secure Layer)
        的组合使用，加密HTTP的通信内容.使用SSL建立安全的通信线路过后，就可以在该线路上进行HTTP通信了。
        与SSL组合使用的HTTP就是HTTPS。
        
        2. 内容的加密：将通过HTTP协议传输的内容本身进行加密处理后再传输；需要客户端和服务端同时具备加密和解密
        的功能。但是仍有可能被篡改。
        
- 不验证通信方的身份就有可能遭遇伪装：任何人都可以发送请求，服务器可能被伪装，客户端可能被伪装，无法
    确定权限，无法拒绝海量请求；SSL使用证书手段确认通信双方。
    
-  无法证明报文的完整性，可能被篡改：客户端和服务端的内容可能存在不一致的情况。
    
 介于以上HTTP本身的缺点，我们有必要使用HTTPS，它提供了认证，加密以及摘要功能。
 
 #### 2. HTTP + 加密 + 认证 + 完整性保护 = HTTPS
 
- HTTP加上认证和加密等机制，就是HTTPS；我们在浏览器访问时，地址可以看到https以及一个锁的字样；

- HTTPS就是身披SSL外壳的HTTP

通常HTTP是直接和TCP通信的，当使用SSL后，HTTP首先和SSL通信，然后再又SSL和TCP进行通信。

- 相互交换密钥的公开密钥加密技术

几种加密的技术：
    
    1. 共享密钥加密：加密解密都使用同一个密钥，也叫做对称加密方法；
    2. 使用两把密钥的公开密钥加密.
    
HTTPS 采用混合加密的方式：公开密钥加密的效率较低，因此我们充分利用两者的优势，在交换密钥环节使用公开密钥
加密，后面的传输则可以使用共享密钥的对称加密方式。

- 证明公开密钥正确性的证书

公开密钥加密的缺点是无法保证公开的密钥就是就是真实的密钥；为了解决这个问题，可以使用数字证书认证机构颁发的
公开密钥证书。

#### 3. HTTPS 的安全通信机制

    1. client 发送client hello 报文开始SSL通信。报文包含SSL版本、加密组件列表等。
    2. server收到报文后，若可以SSL通信，则响应一个SSL报文，同样该报文包含SSL版本、加密组件等信息。
    3. 之后server发送certificate报文，该报文中包含公开密钥加密证书
    4. 最后server端发送server done给client，表示SSL协议初阶段的握手协商结束。
    5. SSL第一次握手结束后，client发送 client key exchangg报文回应server，报文包含通信加密中使用的随机字符串
    且报文会曹勇之前的公开密钥加密。
    6. 接着client发送change Cipher Spec 报文，该报文通知server随后的报文将采用之前协商的随机字符串加密。
    7. 最后clien发送finished报文，该报文包含连接至今全部报文的整体校验。本次握手是否成功，需要以server能
    否正确解析该报文为准。
    8. server同样发送change Cipher Spec 报文。
    9. server 同样发送 finished 报文。
    10. server和client的finished报文交换完成后，SSL连接建立成功。此后的同时会收到SSL保护，此处开始的应用层协议
    的通信，即发送HTTP报文。
    11. 应用层协议通信，即发送HTTP响应。
    12. 最后又客户端断开连接。发送close_notifiy报文，之后发送TCP FIN报文来关闭连接。
    
 在SSL下的HTTP报文，应用层发送的数据会附加一种叫做MAC的报文摘要，MAC能够直接查知报文是否被篡改，
 从而保证报文的完整性。下图为HTTPS的整个流程。
 
 ![HTTPS的整个流程]()
 
 - TSL和SSL
 
 TSL是以SSL为原型开发的协议
 
 - SSL协议慢吗？
 
 由于HTTPS需要在server和client两端做加密和解密处理，因此会消耗CPU和内存等资源，会慢一些。
 
 - 为什么不一直使用HTTPS？
 
 与纯文本相比，加密会消耗更多的硬件资源，因此一般都是需要保护的资源才使用HTTPS通信。
 另外使用HTTPS肯定需要证书，而证书的成本也比较高。
 